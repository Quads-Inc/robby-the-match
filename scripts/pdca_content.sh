#!/bin/bash
source ~/robby-the-match/scripts/utils.sh
init_log "pdca_content"

run_claude "
ãŠå‰ã¯ROBBY THE MATCHã®çµŒå–¶å‚è¬€ã ã€‚CLAUDE.mdã‚’èª­ã‚ã€‚
ä»Šæ—¥ã¯$(date +%A)ï¼ˆæ›œæ—¥${DOW}ï¼‰ã€‚

ã€ã‚³ãƒ³ãƒ†ãƒ³ãƒ„PDCAã‚µã‚¤ã‚¯ãƒ«ã€‘

â–  Plan
1. PROGRESS.mdã‹ã‚‰ç›´è¿‘ã®æŠ•ç¨¿ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹ã‚’ç¢ºèª
2. content/generated/ ã«ä»Šæ—¥åˆ†ã®ç´ æãŒã‚ã‚‹ã‹ç¢ºèª
   â†’ ã‚ã‚Œã°å“è³ªãƒã‚§ãƒƒã‚¯ã®ã¿ã€ãªã‘ã‚Œã°æ–°è¦ç”Ÿæˆ
3. éŽåŽ»ã®é«˜ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹æŠ•ç¨¿ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’PROGRESS.mdã‹ã‚‰æŠ½å‡º
4. ã‚«ãƒ†ã‚´ãƒªMIXï¼ˆ40%ã‚ã‚‹ã‚ã‚‹/25%è»¢è·/20%çµ¦ä¸Ž/5%ç´¹ä»‹/10%ãƒˆãƒ¬ãƒ³ãƒ‰ï¼‰ã¨
   éŽåŽ»7æ—¥ã®å®Ÿç¸¾ã‚’ç…§åˆã—ã¦ä»Šæ—¥ã®ã‚«ãƒ†ã‚´ãƒªã‚’æ±ºå®š

â–  Do
5. å°æœ¬JSONç”Ÿæˆï¼ˆprompt_template.mdã«å¾“ãˆï¼‰
   - ãƒšãƒ«ã‚½ãƒŠã€ŒãƒŸã‚µã‚­ã€ãŒ3ç§’ã§æ­¢ã¾ã‚‹ã‹è‡ªå•
   - ãƒ•ãƒƒã‚¯20æ–‡å­—ä»¥å†…ã€å„ã‚¹ãƒ©ã‚¤ãƒ‰30æ–‡å­—ä»¥å†…
   - CTA 8:2ãƒ«ãƒ¼ãƒ«ï¼ˆéŽåŽ»7æ—¥åˆ†ã®CTAæ¯”çŽ‡ã‚’ç¢ºèªã—ã¦èª¿æ•´ï¼‰
6. content/generated/${TODAY}_å°æœ¬.json ã«ä¿å­˜
7. python3 scripts/generate_slides.py ã§6æžšã‚¹ãƒ©ã‚¤ãƒ‰ç”Ÿæˆ
8. Slacké€šçŸ¥: ãƒ•ãƒƒã‚¯æ–‡+ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³+æŠ•ç¨¿äºˆå®šæ™‚é–“
9. Postizä¸‹æ›¸ãã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆ17:30 JSTã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼‰
   å¤±æ•—æ™‚: ffmpegã§MP4 â†’ ãã‚Œã‚‚ãƒ€ãƒ¡ãªã‚‰Slackã«ç”»åƒ+ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³é€ä¿¡

â–  Check
10. ã‚¹ãƒ©ã‚¤ãƒ‰6æžšã®å­˜åœ¨ç¢ºèª
11. JSONå¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆid, hook, slides, caption, hashtagsï¼‰æ¤œè¨¼
12. ãƒ•ãƒƒã‚¯æ–‡20æ–‡å­—ãƒã‚§ãƒƒã‚¯

â–  Act
13. PROGRESS.mdã«è¿½è¨˜:
    ã‚³ãƒ³ãƒ†ãƒ³ãƒ„IDã€ã‚«ãƒ†ã‚´ãƒªã€ãƒ•ãƒƒã‚¯æ–‡ã€æŠ•ç¨¿ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«æ™‚é–“
14. KPIãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®ã€Œç´¯è¨ˆæŠ•ç¨¿æ•°ã€ã‚’ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆ
15. æŠ€è¡“çš„å•é¡ŒãŒã‚ã‚Œã°CLAUDE.mdã®å¤±æ•—ãƒ­ã‚°ã«è¿½è¨˜

å®Œäº†å ±å‘Šã¯ä¸è¦ã€‚ã‚¹ã‚¯ãƒªãƒ—ãƒˆå´ã§Slacké€šçŸ¥ã™ã‚‹ã€‚
"

git_sync "content: ${TODAY} ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç”Ÿæˆ"
update_progress "ðŸ“± ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç”Ÿæˆ" "$(cat content/generated/${TODAY}_*.json 2>/dev/null | python3 -c 'import sys,json; d=json.load(sys.stdin); print(f"ID:{d.get(\"id\",\"?\")} ã‚«ãƒ†ã‚´ãƒª:{d.get(\"category\",\"?\")} ãƒ•ãƒƒã‚¯:{d.get(\"hook\",\"?\")}")' 2>/dev/null || echo 'ç”Ÿæˆæƒ…å ±å–å¾—å¤±æ•—')"
slack_report "ðŸ“± ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç”Ÿæˆ"
echo "[$TODAY] pdca_contentå®Œäº†" >> "$LOG"
