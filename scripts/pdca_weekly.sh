#!/bin/bash
source ~/robby-the-match/scripts/utils.sh
init_log "pdca_weekly"

run_claude "
ãŠå‰ã¯ROBBY THE MATCHã®çµŒå–¶å‚è¬€ã ã€‚CLAUDE.mdã‚’èª­ã‚ã€‚

ã€é€±æ¬¡PDCAã‚µã‚¤ã‚¯ãƒ«ã€‘

â–  Planï¼ˆä»Šé€±ã®åˆ†æžï¼‰
1. PROGRESS.mdã®ä»Šé€±åˆ†ï¼ˆæœˆæ›œã€œåœŸæ›œï¼‰ã®å…¨è¨˜éŒ²ã‚’èª­ã‚
2. é›†è¨ˆ:
   - æŠ•ç¨¿æ•°ï¼ˆç›®æ¨™: é€±4æœ¬ä»¥ä¸Šï¼‰
   - ã‚«ãƒ†ã‚´ãƒªåˆ¥æœ¬æ•°+åã‚Šãƒã‚§ãƒƒã‚¯
   - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹ãƒ‡ãƒ¼ã‚¿ï¼ˆå†ç”Ÿæ•°ã€ä¿å­˜çŽ‡ã€ã‚³ãƒ¡ãƒ³ãƒˆæ•°ï¼‰
   - SEOæ–½ç­–ã®å®Ÿæ–½æ•°
   - ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ•°
   - Slacké€šçŸ¥ã®æˆåŠŸçŽ‡
3. git log --oneline --since='7 days ago' ã§å…¨ã‚³ãƒŸãƒƒãƒˆç¢ºèª
4. é«˜ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹ã¨ä½Žãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹ã®ç‰¹å¾´ã‚’åˆ†æž
5. ãƒ”ãƒ¼ã‚¿ãƒ¼ãƒ»ãƒ†ã‚£ãƒ¼ãƒ«ã®å•ã„ã‚’è‡ªå•:
   ã€Œä»Šé€±ã‚„ã£ãŸã“ã¨ã§ã€æœ¬å½“ã«çœ‹è­·å¸«ã®è¡Œå‹•ã‚’å¤‰ãˆãŸæ–½ç­–ã¯ã‚ã‚‹ã‹ï¼Ÿ
    æ•°å­—ã®æ”¹å–„ã§ã¯ãªãã€1äººã®çœ‹è­·å¸«ã®æ„æ€æ±ºå®šã«å½±éŸ¿ã‚’ä¸ŽãˆãŸã‹ï¼Ÿã€

â–  Doï¼ˆæ¬¡é€±è¨ˆç”»+ä¸€æ‹¬ç”Ÿæˆï¼‰
6. CLAUDE.mdã®ãƒžã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ã¨ç…§åˆ:
   - Week 1-2: æœ€åˆã®5æŠ•ç¨¿å®Œäº†ï¼Ÿ
   - Week 3-4: ç´¯è¨ˆ20æŠ•ç¨¿ã€å¹³å‡å†ç”Ÿæ•°500ä»¥ä¸Šï¼Ÿ
   - Month 2: LINEç™»éŒ²5åä»¥ä¸Šï¼Ÿ
   - Month 3: åˆå›žæˆç´„ï¼Ÿ
7. æœªé”ã®å ´åˆã€æœªé”æ™‚åˆ¤æ–­åŸºæº–ã«å¾“ã£ã¦æ–¹é‡ä¿®æ­£ã‚’ææ¡ˆ
   â€» æˆ¦ç•¥å¤‰æ›´ã¯Slackã§YOSHIYUKIã«ç¢ºèªã€‚å‹æ‰‹ã«å¤‰ãˆã‚‹ãªã€‚
8. æ¥é€±7æ—¥åˆ†ã®å°æœ¬ã‚’ä¸€æ‹¬ç”Ÿæˆ:
   - æœˆæ›œ:ã‚ã‚‹ã‚ã‚‹ ç«æ›œ:ã‚ã‚‹ã‚ã‚‹ æ°´æ›œ:è»¢è·
   - æœ¨æ›œ:ã‚ã‚‹ã‚ã‚‹ é‡‘æ›œ:çµ¦ä¸Ž åœŸæ›œ:ãƒˆãƒ¬ãƒ³ãƒ‰ æ—¥æ›œ:è»¢è·
   - CTA 8:2ãƒ«ãƒ¼ãƒ«ï¼ˆæœˆã€œé‡‘:ã‚½ãƒ•ãƒˆ åœŸ:ã‚½ãƒ•ãƒˆ æ—¥:ãƒãƒ¼ãƒ‰ï¼‰
   - ä»Šé€±ã®é«˜ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å„ªå…ˆ
9. content/generated/{å„æ›œæ—¥ã®æ—¥ä»˜}_å°æœ¬.json ã§ä¿å­˜
10. å…¨42æžšã®ã‚¹ãƒ©ã‚¤ãƒ‰ç”»åƒã‚’ç”Ÿæˆ

â–  Checkï¼ˆå“è³ª+æˆ¦ç•¥ç¢ºèªï¼‰
11. 7æœ¬ã®å°æœ¬+42æžšã®ç”»åƒãŒå…¨ã¦å­˜åœ¨ã™ã‚‹ã‹
12. CTAæ¯”çŽ‡ãŒè¨­è¨ˆé€šã‚Šã‹
13. ä»Šé€±ã¨ã®å·®åˆ¥åŒ–ãŒã§ãã¦ã„ã‚‹ã‹ï¼ˆåŒã˜ãƒ•ãƒƒã‚¯ã®ä½¿ã„å›žã—ã¯ãªã„ã‹ï¼‰

â–  Actï¼ˆè‡ªå·±æ”¹å–„+è¨˜éŒ²ï¼‰
14. CLAUDE.mdã«åæ˜ :
    - åŠ¹ã„ãŸãƒ•ãƒƒã‚¯ãƒ‘ã‚¿ãƒ¼ãƒ³ â†’ â˜…ãƒžãƒ¼ã‚¯ä»˜ãã§ã‚¹ãƒˆãƒƒã‚¯è¿½åŠ 
    - å¤±æ•—ãƒ‘ã‚¿ãƒ¼ãƒ³ â†’ âœ•ãƒžãƒ¼ã‚¯ä»˜ãã§å¤±æ•—ãƒ­ã‚°è¿½åŠ 
    - MIXæ¯”çŽ‡èª¿æ•´ãŒå¿…è¦ãªã‚‰ææ¡ˆï¼ˆSlackç¢ºèªå¿…é ˆï¼‰
15. PROGRESS.mdã«Week Xã‚µãƒžãƒªã‚’è¿½è¨˜:
    - é€±é–“KPIï¼ˆæŠ•ç¨¿æ•°ã€å†ç”Ÿæ•°ã€LINEç™»éŒ²ã€SEOæ–½ç­–ï¼‰
    - æœ€ã‚‚ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆãŒã‚ã£ãŸæ–½ç­–
    - æ¥é€±ã®é‡ç‚¹æ–½ç­–
    - ãƒžã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³é€²æ—
16. KPIãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’æœ€æ–°ã«æ›´æ–°

å®Œäº†å ±å‘Šã¯ä¸è¦ã€‚ã‚¹ã‚¯ãƒªãƒ—ãƒˆå´ã§Slacké€šçŸ¥ã™ã‚‹ã€‚
" 45

git_sync "weekly: Week${WEEK_NUM} æŒ¯ã‚Šè¿”ã‚Š+æ¥é€±åˆ†ç”Ÿæˆ"

# é€±æ¬¡ãƒ¬ãƒãƒ¼ãƒˆSlacké€ä¿¡
WEEKLY_KPI=$(grep -A 10 'KPIãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰' PROGRESS.md 2>/dev/null | head -12)
slack_notify "ðŸ“ˆ Week${WEEK_NUM} é€±æ¬¡ãƒ¬ãƒãƒ¼ãƒˆ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
${WEEKLY_KPI}
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
æ¥é€±7æœ¬ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç”Ÿæˆæ¸ˆã¿ã€‚
è©³ç´°ã¯PROGRESS.mdå‚ç…§ã€‚"

echo "[$TODAY] pdca_weeklyå®Œäº†" >> "$LOG"
