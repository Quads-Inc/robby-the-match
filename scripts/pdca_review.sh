#!/bin/bash
source ~/robby-the-match/scripts/utils.sh
init_log "pdca_review"

run_claude "
ãŠå‰ã¯ROBBY THE MATCHã®çµŒå–¶å‚è¬€ã ã€‚CLAUDE.mdã‚’èª­ã‚ã€‚

ã€æ—¥æ¬¡ãƒ¬ãƒ“ãƒ¥ãƒ¼PDCAã‚µã‚¤ã‚¯ãƒ«ã€‘

â–  Plan
1. PROGRESS.mdã®ä»Šæ—¥ã®å…¨è¨˜éŒ²ã‚’èª­ã‚
2. logs/pdca_morning_${TODAY}.log ã¨ logs/pdca_content_${TODAY}.log ã‚’èª­ã‚
3. ä»Šæ—¥ã®å…¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®æˆå¦ã‚’æ•´ç†

â–  Doï¼ˆãƒ‡ãƒ¼ã‚¿åŽé›†ï¼‰
4. Postiz CLIã§ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹å–å¾—ã‚’è©¦ã¿ã‚ï¼ˆå¤±æ•—ã—ã¦ã‚‚OKï¼‰
5. git log --since='1 day ago' ã§ä»Šæ—¥ã®ã‚³ãƒŸãƒƒãƒˆä¸€è¦§å–å¾—
6. content/generated/ ã®ä»Šæ—¥åˆ†ãƒ•ã‚¡ã‚¤ãƒ«æ•°ã‚’ç¢ºèª

â–  Checkï¼ˆè‡ªå·±è¨ºæ–­ï¼‰
7. ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ:
   â–¡ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯ç”Ÿæˆã•ã‚ŒãŸã‹
   â–¡ SEOæ”¹å–„ã¯å®Ÿæ–½ã•ã‚ŒãŸã‹
   â–¡ git pushã¯æˆåŠŸã—ãŸã‹ï¼ˆGitHub Pagesã«ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚ŒãŸã‹ï¼‰
   â–¡ Slacké€šçŸ¥ã¯é€ä¿¡ã•ã‚ŒãŸã‹
   â–¡ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã„ãªã„ã‹ï¼ˆãƒ­ã‚°ã«ERROR/WARNã‚’grepï¼‰
   â–¡ CLAUDE.mdã®ç¦æ­¢äº‹é …ã«é•åã—ã¦ã„ãªã„ã‹
   â–¡ ã‚³ã‚¹ãƒˆç™ºç”Ÿã—ã¦ã„ãªã„ã‹
8. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Œã°åˆ†æž

â–  Actï¼ˆæ”¹å–„å®Ÿè¡Œ+æ˜Žæ—¥æº–å‚™ï¼‰
9. æ”¹å–„ç‚¹ãŒã‚ã‚Œã°å³æ™‚ä¿®æ­£ï¼ˆã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒã‚°ã€CLAUDE.mdæ›´æ–°ï¼‰
10. æ˜Žæ—¥ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç´ æãŒã‚ã‚‹ã‹ç¢ºèª â†’ ãªã‘ã‚Œã°Slackè­¦å‘Š
11. PROGRESS.mdã«æ—¥æ¬¡ã‚µãƒžãƒªã‚’è¿½è¨˜:
    - ä»Šæ—¥ã®æˆæžœï¼ˆæŠ•ç¨¿æ•°ã€SEOæ–½ç­–ã€ã‚¨ãƒ©ãƒ¼æ•°ï¼‰
    - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹ãƒ‡ãƒ¼ã‚¿ï¼ˆã‚ã‚Œã°ï¼‰
    - ç™ºè¦‹ã—ãŸæ”¹å–„ç‚¹
    - æ˜Žæ—¥ã‚„ã‚‹ã“ã¨
12. KPIãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®æ•°å€¤ã‚’æ›´æ–°

å®Œäº†å ±å‘Šã¯ä¸è¦ã€‚ã‚¹ã‚¯ãƒªãƒ—ãƒˆå´ã§Slacké€šçŸ¥ã™ã‚‹ã€‚
"

git_sync "review: ${TODAY} æ—¥æ¬¡ãƒ¬ãƒ“ãƒ¥ãƒ¼"

# æ—¥æ¬¡ãƒ¬ãƒãƒ¼ãƒˆã‚’Slacké€ä¿¡ï¼ˆPROGRESS.mdã®ä»Šæ—¥ã‚»ã‚¯ã‚·ãƒ§ãƒ³å…¨ä½“ï¼‰
TODAY_REPORT=$(sed -n "/## ${TODAY}/,/## [0-9]/p" PROGRESS.md 2>/dev/null | head -50)
if [ -n "$TODAY_REPORT" ]; then
  slack_notify "ðŸ“Š ${TODAY} æ—¥æ¬¡ãƒ¬ãƒãƒ¼ãƒˆ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
${TODAY_REPORT}
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
else
  slack_notify "ðŸ“Š ${TODAY} æ—¥æ¬¡ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œäº†ã€‚è©³ç´°ã¯PROGRESS.mdå‚ç…§ã€‚"
fi

echo "[$TODAY] pdca_reviewå®Œäº†" >> "$LOG"
